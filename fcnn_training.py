# import timm
import torch
import torch.nn as nn
from torch.utils.data import random_split, DataLoader, TensorDataset
from tqdm import tqdm
torch.manual_seed(0)
import numpy as np 
import pandas as pd

def __transform(X):
    mean = np.array([107.29270833333334, 119.2375, 125.85729166666667, 114.86041666666667, 125.778125, 122.08958333333334, 126.66354166666666, 127.94270833333333, 129.33333333333334, 127.22604166666666, 111.47916666666667, 132.759375, 130.05, 130.165625, 125.3, 126.490625, 130.590625, 131.89583333333334, 122.50625, 130.18854166666668, 127.70833333333333, 132.77708333333334, 130.74895833333332, 130.765625, 129.92708333333334, 126.525, 129.99895833333332, 127.06458333333333, 128.91770833333334, 129.815625, 126.62604166666667, 128.39895833333333, 129.31458333333333, 128.359375, 126.38125, 127.60833333333333, 129.62291666666667, 118.92916666666666, 126.98229166666667, 126.62708333333333, 127.55416666666666, 127.37083333333334, 125.51041666666667, 123.7, 125.88229166666666, 125.06666666666666, 124.82916666666667, 123.37916666666666, 126.071875, 123.38020833333333, 118.84479166666667, 120.828125, 123.20104166666667, 121.240625, 123.759375, 120.46458333333334, 124.56041666666667, 119.165625, 119.85104166666666, 125.18333333333334, 123.06875, 124.71875, 122.403125, 121.32916666666667, 121.76979166666666, 120.48125, 121.409375, 123.01041666666667, 121.77708333333334, 120.79270833333334, 119.51145833333334, 123.78333333333333, 119.53229166666667, 120.315625, 120.959375, 118.73125, 117.721875, 118.13125, 115.94479166666666, 118.82604166666667, 118.796875, 118.38541666666667, 119.428125, 114.84375, 115.39791666666666, 117.309375, 114.14479166666666, 115.48020833333334, 114.3125, 110.96145833333334, 110.79583333333333, 114.27916666666667, 108.76770833333333, 111.921875, 110.93958333333333, 112.30833333333334, 114.109375, 109.78958333333334, 113.27083333333333, 110.55104166666666])
    components = np.array([[0.12045456236398425, 0.13274743869959152, 0.12197307355675266, 0.12743299091720234, 0.11490209251739833, 0.14563737064685178, 0.13257213216265878, 0.10982553740327912, 0.1033285554752961, 0.13472662522721837, 0.13734539959726674, 0.10717686122229292, 0.0972455689737119, 0.09628519283479933, 0.14261904858919425, 0.1274903009982629, 0.10746528096890201, 0.10549243881559629, 0.14624097373324552, 0.08108330657246215, 0.11565117251515195, 0.08579984559652909, 0.07722077328005046, 0.07356429499109529, 0.07806792713561538, 0.1287830706405758, 0.0770938218445555, 0.12127314449485128, 0.10529145520977692, 0.0666737897880095, 0.12106663037789264, 0.10715468133676069, 0.06518153953203541, 0.06902913017385172, 0.12905097869304238, 0.09918042049938723, 0.0670503038556256, 0.12025846624581893, 0.08264605744884729, 0.1095198874982001, 0.10408321252730723, 0.08701059785262559, 0.1159165261853803, 0.12762053759983283, 0.11488463158159773, 0.10753555331889526, 0.06239375044176811, 0.034823058379854714, 0.02821482747719719, 0.03143676575752331, 0.14334186728122542, 0.1267335944406827, 0.03686502722948758, 0.13122688070663696, 0.11441436163465821, 0.1276718406937713, 0.08634401201400563, 0.13748343666463453, 0.128694146295196, 0.02373159202829569, 0.05472651466163828, 0.07333156527941177, 0.07007496928305562, 0.04208686952314014, 0.1214657842369948, 0.04442965017198557, 0.06312655648383185, 0.026230248378694764, 0.12260281057713285, 0.027896561794885897, 0.04593648103381148, 0.0946624014566409, 0.05982694826613285, 0.11309389353078224, 0.11660618736201625, 0.11133109128239174, 0.10309342278889524, 0.05930267586295026, 0.08657556461440363, 0.06582397440491987, 0.0738072514129298, 0.07233486958023887, 0.06803912018462172, 0.08114562436494083, 0.12379198451153776, 0.07393364108445967, 0.1240012483989432, 0.08259621292599414, 0.07575397097656476, 0.08680707790068476, 0.06958914690998033, 0.10565889068394682, 0.11843116996881459, 0.09056368294316583, 0.09582610184821727, 0.09883256528611857, 0.1020105774312687, 0.102298878258458, 0.10326276381580185, 0.10380850799693964], [0.07427695211631623, 0.039811882262788464, -0.03349637993629075, 0.07786228194018201, -0.04668111519257428, -0.04429491972822766, -0.06616004146776565, -0.05539772065500931, -0.07812219709386471, -0.0954502500976247, 0.028405697724875847, -0.09341173749111467, -0.08586524685221456, -0.03633013419234499, -0.06802162009429634, -0.11684891229065152, -0.11303816812619571, -0.10743968823164149, -0.04010572641021138, -0.08030950995566959, -0.1382645944719659, -0.10202808740785227, -0.09369053960007831, -0.08837503155059326, -0.08049639035345198, -0.1194818303048421, -0.07592769638889951, -0.148171739843941, -0.1423307349094092, -0.08718378633837494, -0.15062669160662345, -0.15776940925897492, -0.0947036959693789, -0.06382235583823519, -0.11334686969028257, -0.14174920744926087, -0.07009150723064844, 0.07103863887897335, -0.1341812731761232, -0.14863976326585523, -0.14601685383629293, -0.12879958053358803, -0.09275187591127693, -0.06790394078104754, -0.09629473166305665, -0.09744207087600869, -0.08898475593215555, -0.027503247631508732, -0.029412932682782222, -0.02156300367284392, 0.03779412889438717, -0.02729707920164131, -0.04812680782505255, -0.009169112735356214, 0.08173159150866774, -0.009226650762017504, 0.05318691366286438, 0.019987926246070327, 0.0026706068756526136, -0.01263329970725933, 0.04433032057334482, 0.054089944768277526, -0.06097541590118143, 0.02522927017425784, 0.1219033582910201, 0.029924094269158933, -0.038610018877666546, 0.0019078300387098898, 0.11921535197772462, 0.016775564869322034, 0.045428814635574924, 0.08856814323949107, 0.06321333193543278, 0.11648889565062699, 0.125526103394427, 0.0788354561418703, 0.055582546733798206, 0.08211279023904117, 0.058071048525764904, 0.08867322019446262, 0.0991915170010914, 0.0959334774800818, 0.09086193340213786, 0.07455462548062056, 0.11684583745026536, 0.12484032654355763, 0.12613985770587924, 0.1366128164934378, 0.10986248072218481, 0.12082727116476369, 0.1256353721159883, 0.15499526647986886, 0.13862112119684145, 0.17577415475772637, 0.18337757148419756, 0.19059198440380404, 0.19439996791019978, 0.1767974026432745, 0.18646453874321384, 0.1754916175670913], [-0.00933256141156874, 0.023120614961157915, 0.0693989313969695, 0.01320238045168485, 0.08287013529852502, -0.05719173269893544, -0.035953800288682725, 0.11788972007037492, 0.11117898797695132, -0.0452642918909738, -0.10116366389321987, 0.05225558452311782, 0.13427427317192686, 0.1397534015827757, -0.07242343692319783, -0.040964644302417814, -0.00015042935818411593, 0.022502483142039273, -0.09590072351874171, 0.18175424571136478, -0.04495378509408897, 0.07473305657100075, 0.14730941215950036, 0.1815032331989981, 0.18975890215123103, -0.07348865894980773, 0.1866256679593169, -0.06084908238234042, -5.814339640359373e-05, 0.181225679310337, -0.05398453319049602, -0.026784868749734826, 0.1581044699710331, 0.17672958032914846, -0.0806556076008471, -0.004352907835311327, 0.17996190012133742, 0.03218130192539418, 0.02605439661610908, -0.056070083325005536, -0.019477901682154665, -0.0234080180757932, -0.09251128540560188, -0.11393122047871658, -0.09599712630457427, -0.08840771275093223, 0.006796029985824794, 0.13927211803076323, 0.12192889818679055, 0.13499493138637106, -0.12036253989768227, -0.1472185783491534, 0.04533679746868221, -0.14667255699909962, 0.04290591743655356, -0.1498826878367511, 0.08724558056189287, -0.14489232304489794, -0.14859181490368206, 0.0846090308389735, 0.12793861507352094, 0.10387118208689004, -0.03334203735106001, 0.12860997603586816, 0.010892557854740343, 0.13585234272550817, -0.030742624780094256, 0.11436691275655281, 0.02903076356044326, 0.11724128429849787, 0.1370038557088258, 0.07454116849630293, 0.1289058938470337, 0.03382322702821473, 0.032933875329329766, -0.11902302581459101, -0.11381757701140115, 0.13643143061013904, -0.09255685848090382, 0.1354200149509334, 0.12618990609923333, 0.12605427466988936, 0.1311490116995681, -0.07224096602084207, -0.10699237669525903, 0.10526487698300684, -0.11863383448356166, 0.08185983076167806, -0.07325214189173063, -0.053945257756468655, 0.03839384328102334, -0.10927154338337101, -0.0964051943561984, 0.03893455101188017, 0.013733913498424264, 0.035494554136905804, 0.03668729307078847, -0.0216091032169731, 0.025559314929695934, 0.011426664880903218], [-0.23136933185503336, -0.2161020031042708, -0.18614653500540906, -0.21139272470533232, -0.18384493235520186, -0.1473728166876649, -0.11569871202261714, -0.15142756249926323, -0.12553444099310748, -0.08691636120402525, -0.16798106109277552, -0.06870366391362498, -0.11940729734616841, -0.10525042868656297, -0.06071405338000366, -0.04701581375877308, -0.031527354383220275, -0.045670329824784424, -0.08712493621008481, -0.0662479179585096, 0.03280338740468068, -0.005989226514360573, -0.04015225355074549, -0.052575068928006154, -0.06201255054896384, 0.009139574921949561, -0.05165349260558421, 0.04408083288719093, 0.053535220783568815, -0.024906349388148685, 0.060330599157271646, 0.06349041422671207, 0.0034333332000897037, -0.01838398396273624, 0.031190663566890986, 0.07740046596960165, -0.005771120586185805, -0.11166499412362511, 0.07174939430375468, 0.10481094707684382, 0.11459262854654928, 0.11577271935834052, 0.13387807033772428, 0.09377749863163286, 0.13974081005304714, 0.13943980254343646, 0.11069988427427516, 0.08848291733735344, 0.05623294235263613, 0.09605194955199742, -0.03774518705571989, 0.07929869449875707, 0.05469575015560545, 0.07975557398833436, -0.0525108514461137, 0.08310176948981614, 0.05968445492410431, 0.008213113802162948, 0.06953349899683414, 0.08027987569203661, 0.11477975798489026, 0.07104927585181656, 0.14458268752273934, 0.1546593657926004, -0.1302978643662246, 0.15105855466209336, 0.14424853244241057, 0.13786178490909318, -0.10199399099609359, 0.13319744494493838, 0.13941464120046043, 0.035344122047088554, 0.13851148548200126, -0.04362465701927064, -0.04018818503163499, 0.07099852579033225, 0.11080055792008016, 0.13769481525580754, 0.09918930692260736, 0.13882795644208157, 0.14111957849920137, 0.1432555357853417, 0.1364184612027381, 0.10025995635559283, 0.019386169175211455, 0.11289733853935753, -0.0018287142622586483, 0.07711110255685606, 0.08659532553714122, 0.06501048068275507, 0.0824184262300564, 0.030848667801378286, -0.04721815895296625, 0.028907488100513957, 0.005245586939032924, 0.01317394246796655, 0.008760230609220763, -0.0177006291572831, -0.04629341678740108, -0.0746177027149871], [0.037690048895080513, 0.06110901644853692, -0.02563939014606337, 0.07314304075321906, -0.040236179479766314, 0.09510885387480432, 0.08320258765694977, -0.05571163659022529, -0.06740748104299649, 0.11141473441359251, 0.05194649778048965, 0.007972035364389177, -0.09255412404517871, -0.0639157776646988, 0.11446200894873339, 0.10271520285444792, 0.06695870017450263, 0.043407442712117994, 0.07618864035713319, -0.1494222425830938, 0.1172316655543906, -0.062162179820383245, -0.13079400003184702, -0.16691833166610143, -0.1593614255345527, 0.12427005934826571, -0.15459458074548874, 0.10961225312185131, 0.09998789310933798, -0.1669161858251823, 0.09983000042887265, 0.10583006987965708, -0.14416557061183316, -0.12830334084395348, 0.09675121479434962, 0.07698603582322253, -0.14977048434429893, 0.052962353686343486, 0.045453669164962365, 0.05401825129613267, 0.05408480440673684, 0.01322945644898536, 0.018156612982707623, -2.643536993658978e-05, -0.0007624628175847783, -0.012365930856381538, -0.017403443008057764, -0.09510115775194311, -0.11054496707250897, -0.09933343603387611, -0.06288330478764137, -0.08178078983880593, -0.0879314907146351, -0.09396771286954639, 0.08045173550541573, -0.11698485253616438, 0.08753087008008031, -0.1105918422025972, -0.12791781476564604, -0.08615673813181468, 0.0215511179917506, 0.05504815118480838, -0.09194195191311737, -0.0067335044712435715, 0.08581343654393875, 0.0015137085479382806, -0.08937044235930146, -0.018613147916496296, 0.08345921639601772, -0.017350708994243912, 0.0386248617946886, 0.1268996168019844, 0.0907049133399694, 0.12772119088872336, 0.10953565114488233, -0.16477268576389428, -0.1551777779841097, 0.14359392779316307, -0.14850591230846186, 0.1662654007074684, 0.1623716089206027, 0.17105241625889933, 0.15165944441720045, -0.13679826278446872, -0.15319993381791844, 0.1478373159639389, -0.14656614748831373, 0.14269203060575847, -0.11787563275335376, -0.10539993789396958, -0.05541117326341737, -0.13165757654801322, -0.11849297781350455, -0.0005581150150285806, -0.05519449699625803, -0.01734966911117594, 0.0047845869500246965, -0.11093433471917709, 0.012868945440663509, 0.0045411143298072715], [-0.08544801279007816, -0.07451420811315274, -0.0016787920694400875, -0.10918954762612285, 0.0006645669368246037, 0.0130536051402424, 0.061630164752323996, -0.01938440747905539, 0.01762022192038726, 0.062242530120766776, -0.04818496696712314, 0.09149100144448237, 0.02774668262861, -0.037273894405343545, 0.008772515025383837, 0.08684843125972866, 0.09893429240832244, 0.1039922005322753, -0.025507714742932494, -0.033433668665663684, 0.10343841323704486, 0.09018278333101025, 0.03167979592272609, 0.012962333165191903, -0.025993574340877065, 0.05451130332856261, -0.024367717552821102, 0.0829361440860803, 0.1349676264621952, -0.0049073887867151665, 0.08909992707969659, 0.13554107672350457, 0.02827409405375425, -0.032198960504094494, 0.009861871182441225, 0.137168154760559, -0.009565414117235122, -0.15699598916553037, 0.11798607405510157, 0.057303050234343594, 0.10155142949331836, 0.04580661270982255, -0.07037105965985341, -0.10799611166033656, -0.0759387157210499, -0.06729899181428671, 0.04562748040318221, -0.004116047928152251, 0.006250635075361293, -0.014446986929008778, -0.09564315734295539, -0.16270692368649578, -0.00561550421082219, -0.18175519709100466, -0.1759027016780315, -0.1752126562788038, -0.13899294543621074, -0.14521024900411644, -0.1709331470776837, -0.006768417925238181, -0.14119063466329487, -0.14743558437406043, -0.021652307090078184, -0.11778345355759993, -0.1348511793029583, -0.10881316139267234, -0.007916248648151393, -0.04573341927655888, -0.15179543719313873, -0.03770827669746697, -0.07691380274892898, -0.13410460574783487, -0.04433648567361676, -0.13488999217757752, -0.10758877893204974, -0.04711261038890101, -0.04825861733951568, -0.016752918643401466, -0.017929802035230265, -0.02400215099187876, -0.02897542905775909, -0.019076724696111113, 0.008779835535542, 0.04676253592826912, 0.020362104140603462, 0.03462711470524901, 0.03220014242271659, 0.06442917200291763, 0.09423155820889059, 0.13414415572930322, 0.1517409186979024, 0.1140725348098644, 0.06651028414839588, 0.2216875721112911, 0.20708884779349615, 0.24060009169998578, 0.22623110932125032, 0.20687550375532346, 0.17441451786789547, 0.13369562916487354], [-0.1219760705647635, 0.0463132204007372, 0.1720429669526137, -0.052328156782684127, 0.19355837240780982, 0.046756002926844634, 0.09474011163159698, 0.15463964494704258, 0.18458943161721786, 0.06059138170460335, -0.07889111265496568, 0.10584048385658008, 0.14004140333517662, 0.07670508029491273, 0.013423286127894125, 0.03323544993929073, 0.06759346856905131, 0.06650399289526991, 0.021926623030574705, 0.02923369946529558, -0.04014394929487553, 0.015226065789636915, 0.003998888368380851, 0.019253289171357758, 0.027091874544370495, -0.038383794179748354, 0.005343334865500343, -0.06508058276124319, -0.07566863148725682, -0.028445901809636277, -0.08436696002671314, -0.08452514896700707, -0.05774176026323166, -0.02360127639836982, -0.05959899072351692, -0.08943128865118732, -0.05354731468146746, -0.09889359481261852, -0.07812257150019004, -0.08528545810122909, -0.0957264200692169, -0.06884811472369304, -0.026569119144643258, 0.020710364498611588, -0.019875690569265126, -0.031467986122785965, -0.060745946607770204, -0.14948340558967876, -0.18405259459324702, -0.16093204753072735, -0.011469733606887356, 0.05079606515754238, -0.10129946548159542, 0.04079505025653498, -0.09517781131572202, 0.046231132110970574, -0.08449054713667736, 0.038262832216934606, 0.04373688761898371, -0.170854495715837, -0.09447662509721509, -0.06528167358085407, 0.023092607858978285, -0.0943601465686493, -0.22817863461541463, -0.08641629431278632, 0.02562904328251365, -0.10456949095036924, -0.17754643117505894, -0.07264082802686594, -0.032979645352043584, 0.0158670834588933, 0.08176847518628272, -0.07503607825738418, -0.07727710652973158, 0.06630406925402084, 0.11384790914931686, 0.16526917457923326, 0.1276625441423596, 0.18840795939388472, 0.19996123653877743, 0.2050638144126683, 0.1828548383166045, 0.1437543367287414, 0.04460060228230856, 0.15464954792546315, 0.01705648060500097, 0.11689472459244661, 0.12153308057451014, 0.0879683164037787, 0.05718745046760029, -0.006545032907214883, -0.05289591263905744, -0.03680821135852304, -0.045767210351066796, -0.07575503795679364, -0.07948312371204176, -0.08787848827830701, -0.1872745934267767, -0.19370808342275783], [-0.09384509098756715, -0.18541606023633617, -0.2235587746836656, -0.07988232314845777, -0.189363743738677, -0.1604168002117627, -0.12258471226337789, -0.11755966767442672, -0.08314066676905627, -0.05490393869784472, -0.11684375790141348, -0.03502406561667093, -0.04483694415366581, 0.03594959272270451, -0.07199612550693085, 0.0028490552267156776, 0.010933760845479978, 0.020704248762714463, -0.10090057896546366, 0.13973838161935168, 0.06488112172502733, 0.0776743954532379, 0.08051823981240239, 0.13202518566657326, 0.150819866828187, -0.004126983004220285, 0.15221667755733412, 0.04924374329829007, 0.06743729928378406, 0.1143302096143318, 0.057340822676574636, 0.07716879736541245, 0.08865835495908402, 0.1377089494314405, 0.007281543897906287, 0.08334374799064963, 0.11606085146634346, 0.08959545145547657, 0.07633630514914845, 0.03486315247955768, 0.06042966995483555, 0.026249423947930506, -0.0500436598009625, -0.042326630122842296, -0.05415141872187776, -0.04917981620835973, -0.015858160648755965, -0.18339150330884357, -0.14714023903622256, -0.20472304747089332, -0.031044174601062634, -0.02691847925922923, -0.09869961220078524, -0.026273897258085606, 0.12283314000570823, -0.02054906099263297, 0.09750243283766148, -0.03234782026055294, -0.0034345696544453535, -0.12216577446256012, -0.08854984319622386, 0.0017750096101744606, -0.04749568450069632, -0.19715538008284214, 0.18315149651882828, -0.1988518482207045, -0.021348290946973308, -0.21520865610667272, 0.17316088831289644, -0.17554410944616156, -0.17124251577106997, 0.12748402299279396, -0.09353257299216866, 0.18814461390515874, 0.17828347913523213, 0.08181982192957603, 0.08669857996762943, -0.00861409921680064, 0.0776317494936701, 0.026041429133859373, 0.058057689459500204, 0.04440590833822983, 0.030885429127526388, 0.05687865655767271, 0.07854081430100102, 0.04385959707463271, 0.04485419360147986, 0.03645249466789311, 0.03440983967289243, 0.04057463801869179, 0.0013963291578930192, 0.0037115895556627003, -0.005286942664958748, -0.039384964196316534, -0.056413981525878315, -0.0506684763972911, -0.06348439823989749, -0.04730603878344295, -0.025024278382738917, 0.002136109915161956], [0.020819927808182502, 0.07242201144489469, 0.006014046648619906, 0.052692280013783156, -0.00657835857929763, 0.045865364761149746, 0.09248821725804464, -0.02354244796036903, -0.008919507458202365, 0.10222177615813656, 0.001884784353924233, 0.08608100968097358, -0.0524601889198646, -0.02322957639180695, -0.013670957874120343, 0.09888851799337434, 0.11629177503670167, 0.11805383704326267, -0.03508898517756673, -0.07199058404936304, 0.0893569564236647, 0.040895343200489584, -0.07188312998888932, -0.07950034949413268, -0.07392697799771607, 0.010901334562897597, -0.056130263612434964, 0.027666971109965514, 0.07993979279860239, -0.05099641999456283, 0.012184906336576713, 0.06102038938829712, -0.06329209483486976, -0.0007622225313691492, -0.061130105578385344, 0.06595324653274495, -0.04153216321798883, 0.0611883246945814, 0.05322352054265438, -0.02521564125707076, 0.021840476716621798, -0.058911301555617725, -0.16299515744845441, -0.16827079092468883, -0.1654989459671485, -0.15095085754521675, -0.011805710960467312, 0.004906811676346552, 0.0074838496244697085, 0.023433118297067696, -0.1018483131998501, -0.176108816961782, 0.062459023382112344, -0.17142580697117582, 0.09324836563719233, -0.1629844074641817, 0.13916896803281106, -0.12020517139098454, -0.14843956078464732, 0.04528846315269598, 0.15219282660482444, 0.1354185721464508, 0.005210837988896095, 0.1314112480632262, 0.02829512387596394, 0.14388090576207427, 0.014600091720581045, 0.07004528944958625, 0.029878284947081085, 0.08314833215221018, 0.10749869473450646, 0.07238264158025169, 0.02931456033562732, 0.016632542229326405, -0.006652310310716504, 0.1425740691138231, 0.14233337008922534, -0.02865464277919114, 0.1639552958002993, -0.056927224769012824, -0.06410660011980206, -0.0761534967643115, -0.07835409610660324, 0.193459584112172, 0.15963567370024567, -0.11451217267229602, 0.15541113441747745, -0.1054315525835646, 0.1840730764768977, 0.1922878620548792, 0.06671773326711576, 0.14794827475894282, 0.08156430216003108, -0.1709678746262989, -0.10002958441812522, -0.18405863959266056, -0.18963577556587627, -0.01847922450243764, -0.1719112198217033, -0.14191225325680226], [-0.11786729349836923, 0.008228239947118939, 0.17115589783096735, -0.009202487320133838, 0.19266641587525118, -0.14997692588119815, 0.0392762082353107, 0.16210262336969178, 0.12670287914305417, -0.0911325283784187, -0.2551004180754173, 0.14572695543144418, 0.11653397308830185, 0.031596694360077435, -0.16499506613419018, -0.06526095286594806, 0.10134443827431124, 0.12779951637161086, -0.19835522687722668, -0.11601580241425791, -0.06261797629896514, 0.11725835656023167, 0.009591250773861072, -0.050560171473570274, -0.13441899123307505, -0.15086997031009033, -0.14494489135136318, -0.10017371786573694, 0.013289116461401967, -0.09385011929859868, -0.08366489702999344, -0.028616932517739155, -0.032987681089740595, -0.12038648259414707, -0.13489074223122846, 0.044304159278805065, -0.12544030813272739, 0.06624089162617827, 0.08869467528634432, 0.025044770859774905, 0.0606300504096339, 0.1329837708078799, 0.10168558785053121, 0.021199796717683662, 0.11227711702146159, 0.12835687481234048, 0.17402725419964998, -0.10720197678114458, -0.10898190633773036, -0.1059931302326204, -0.12972740318381168, 0.04917361817340714, 0.08057976435257735, 0.023524794893666722, 0.19512825643287876, 0.022742651380948168, 0.1738118149269099, -0.05377837796751032, -0.0014268311059039069, -0.03116613717183192, 0.07674641430760033, 0.14716721963327922, 0.13251592747474492, -0.016104926750650582, 0.059009987282686194, 0.0026405358214120667, 0.11025828660874275, -0.06579112051980052, 0.09297834712439883, -0.06788424958504236, -0.011945637391204406, 0.08674677510538517, -0.06089572079817751, 0.08626488422640097, 0.06313860708774255, -0.03990335289296187, -0.01181710323215167, -0.11049295990206262, -0.019912863712885292, -0.1148873008018144, -0.1086566472735499, -0.09834340081003538, -0.09553050697983372, 0.00849675871732242, -0.07535905636354984, -0.06925437242175489, -0.08798567189434833, -0.038604420035512996, -0.01293466818606563, -0.031682139263038915, 0.038378304178693506, -0.04471635865487017, -0.0740172518599364, 0.12003258583085206, 0.07981467031841243, 0.10862310674878661, 0.11040746336562896, -0.012658765598436723, 0.01024027078716295, -0.01335087332828319], [-0.2513397146619068, -0.21422159875146976, -0.11983298293401749, -0.2177401585773792, -0.11220562147821606, 0.10329655494633593, 0.14249177812065766, -0.11662133814925993, 0.003786859081339651, 0.20900854918743592, -0.05016998949578472, 0.2010913943230525, 0.03293791865430868, -0.07628715222039732, 0.0717652011577087, 0.19213719678307378, 0.2187273137818434, 0.22088632300352468, 0.08380040835789401, -0.05775368563911677, 0.05385414696989584, 0.14432109433320647, 0.07154691101866407, 0.010229649539411564, -0.0500535350307136, -0.036760380022317886, -0.04644787430765146, -0.05894258138474855, -0.002682823593482545, 0.003811010079224792, -0.0916294488939777, -0.04540362883196436, 0.07332716025203523, -0.03394010786574071, -0.09339951064968072, -0.06069080417323323, 0.006020195170407457, -0.13842093619474333, -0.04189512875833535, -0.13889415491671694, -0.1141336435076624, -0.17115480339420008, -0.14097235766571117, -0.005386143871112417, -0.13295374037364263, -0.1451893332222384, -0.14988662942495667, 0.07391003598379577, 0.07100767246508805, 0.09623378484396368, 0.0854461613719982, 0.09777877534796466, 0.016217145719486792, 0.14052985568855927, 0.02175993841330336, 0.14791904379897425, 0.07602030578753008, 0.13418061101983783, 0.1673317134819667, 0.019786360315452427, 0.039221507288812386, 0.058328647242477105, -0.146413138170012, 0.020593924980513368, -0.013323002186391408, 0.011205906131295676, -0.13046223599526555, 0.04011465170969129, 0.04265402691955576, 0.0596838618626603, 0.03739321467999482, 0.08215257872459947, -0.007154707464619593, 0.10443557084752703, 0.11029952933493968, 0.043744581140079716, 0.017652072780890732, -0.0388471287035563, -0.017304810096413298, -0.05519359870824777, -0.05696191545581475, -0.05221264218894246, -0.05056383985137804, -0.07768813017840287, -0.045081980195663195, -0.014384054488029862, -0.046726620177391064, 0.002373733814482403, -0.11157388976674415, -0.07550498206821055, -0.023950193442225903, -0.07534282478859937, -0.07259511688853092, 0.09828697327198481, 0.06617607054946366, 0.08529306478270049, 0.07465543802906395, -0.023902700520894014, -0.00880430095988275, -0.03177260804421601], [-0.12255340864125157, 0.0021887822865964534, 0.031399376136131835, -0.08006191524942391, 0.02195326317346911, 0.0154720867254712, -0.00929907844018311, 0.03606282583033518, -0.02091948455332581, 0.04163359836042003, -0.17151248916251677, -0.09919337970118561, -0.0012748914224789921, 0.12644309233654055, 0.0801652771057474, 0.04978235397571914, -0.06630309305352264, -0.093747191221861, 0.015020586027325873, 0.12088685401078547, 0.07216346096783863, -0.18889987256725313, -0.06696573657693831, 0.01899422668747751, 0.12071421836781812, 0.11395738083389495, 0.12689789429850593, 0.1199175419028405, -0.011223336467285286, 0.03025224360379258, 0.11353586518322148, 0.01551622660606098, -0.10295590229647693, 0.10369236671730123, 0.1203009087710298, -0.07511830965386755, 0.04619307716320689, -0.057443995314841234, -0.13617591675709828, 0.03461705750304815, -0.049951006480153354, -0.022240518989906904, 0.08914776009152009, 0.0809430104245696, 0.07858419798347158, 0.07202278815291406, -0.22349510410023352, -0.15403246698118098, -0.19839318070309803, -0.14783699318518426, -0.09179661233026574, 0.023479611926100565, -0.2785099082982101, 0.002745271105208377, -0.0009024933052708843, -0.02408965362424361, 0.1505329600694793, -0.032182532648800666, -0.02656593079961144, -0.19412436226434168, 0.22419960665342523, 0.18425380989298926, -0.14477664601937823, 0.17453705234005445, -0.13993326398134223, 0.18675401420180562, -0.1621063441213844, -0.010307217821062264, -0.0938928213158728, 0.002777997116799885, 0.12884113873538622, 0.039065207205471054, 0.009692245726841818, -0.033274030406764875, -0.022399293490184647, -0.03714886913886047, -0.037115369322559544, -0.07237314872426523, -0.03789989189081548, -0.10439237172733204, -0.10531901603010527, -0.1107001663223393, -0.10932846580005016, -0.03560436744525201, 0.00010029344662279956, -0.12163555601062541, 0.009845171700438403, -0.08366427582713913, 0.027018959133811263, 0.019645351742238984, 0.05781284112465725, 0.0568039318038241, 0.013893129424120743, 0.10189884743514203, 0.11124441107788823, 0.10428252737521722, 0.0838270539553605, 0.09085650088533874, 0.0005851622818494205, -0.05342561151637326], [0.1298628024841948, 0.028941126771515502, 0.022643061955743095, 0.07157188232464941, 0.03288625148136739, -0.1731519059853523, -0.10476770613704306, 0.013230287989520055, 0.044946730602309554, -0.12829229246057997, -0.0019355594230001172, 0.029303994028417865, 0.026149212386844048, -0.033792132031216254, -0.20387165662779477, -0.07779072759387018, 0.03665504332034817, 0.0476884511848377, -0.15474368059892907, -0.05661330661216585, 0.08316168696755388, 0.0767476590061679, 0.06812605860481008, 0.03301714565950346, -0.05930576236133233, -0.09890588252149164, -0.058995396180482385, 0.019358139552143685, 0.1783442980791623, 0.04145819361499844, 0.03590677208524228, 0.1510163234841203, 0.02229916882705904, -0.0649908607604145, -0.09809903344397852, 0.1870709080126245, -0.03492775575143372, -0.009681459780901097, 0.15402714476555082, 0.02540649075703778, 0.11939730777436137, -0.008253707325313992, -0.15639697144548328, -0.06336068944396805, -0.1492937656238162, -0.13379584934624295, -0.005598317999027715, -0.14031637950450532, -0.1300919170955909, -0.12007298325971047, 0.20561041866855623, 0.04395884268212619, -0.07274520394470692, 0.10788743921086227, -0.043517637406183585, 0.1176866146285074, -0.05046971196769881, 0.20873930255739706, 0.13532440792248093, -0.13437490059326776, 0.059310350495176176, 0.025519594561994107, -0.14523831448886662, 0.11417414435745268, -0.03757680544555553, 0.11506170107893965, -0.14824651510658354, 0.018253111868849748, -0.05068070705901394, 0.003955824920981681, 0.1506492813405377, -0.08764075444560303, 0.11285626698852562, -0.13083623630807364, -0.11768765504364341, 0.00582764033307096, -0.051922097055611544, 0.10338618529041094, -0.1300242475970998, 0.08286061162745581, 0.05553786359847603, 0.06057966527291042, 0.04967195595513759, -0.17618605847248087, 0.09885656017379353, -0.06618276609651834, 0.14941147601871266, -0.11482841402618502, -0.1343903284813578, -0.12458418986015084, -0.1165426905320361, 0.03956216087607967, 0.17090324885719688, -0.05270315607408266, 0.006464584169981543, -0.01861128102656601, -0.018495484657761053, 0.11057190312426086, -0.0007022359419505998, 0.020636780395922833], [0.26876257828245365, 0.030342563994513433, -0.12651996147768133, 0.0038643656122664314, -0.15204057760112502, -0.0007641786114773947, 0.04240349428045237, -0.12398342714676804, -0.03160459489078769, 0.06960410309815325, 0.15183707446447356, 0.086276066558795, 0.009647115235141696, 0.04872956517253935, -0.015959122773132436, 0.08335328089461408, 0.14708872412473883, 0.13393239139252028, -0.031985401148430744, 0.02248724886192665, -0.008691290027579662, 0.06035420487588237, 0.05812338556665807, 0.05548948909449838, 0.018202065713419178, -0.0724052662981024, 0.010434544486390088, -0.09038917844485447, -0.01678886645904913, 0.06446967959190432, -0.10335964466427106, -0.03859977664152671, 0.07422664587390942, -0.03308732995540393, -0.07760356829722935, -0.023930686051869852, -0.0004465936845567908, -0.11597531937577653, 0.0105660658921454, -0.05753403788205574, -0.056238909224064444, -0.04835346745876173, 0.03219839544587909, 0.019865591445006478, 0.06677730419693688, 0.09873453565827434, -0.040148072882106374, -0.14690430305458907, -0.1907459542134044, -0.14567273517758497, -0.07295984375072026, 0.014146438032651905, -0.14522710335782665, -0.019634535250515443, -0.1429229825070578, -0.023029066155944126, -0.028649697269900007, -0.09700280778141895, -0.028243530918768203, -0.14171546955384295, 0.06732394563060075, 0.04066035628824726, 0.16280343329888372, 0.13488643563326172, 0.0747280396858497, 0.1281390261172496, 0.20428891230035912, 0.02905812708784834, -0.06258389265271744, 0.031060826384523704, 0.08940228129998092, -0.05138321075623721, 0.03252202845372888, -0.08206193283858289, -0.09214388341189496, 0.09790616147253645, 0.16264193035890315, 0.007395834179908272, 0.15511228441896663, -0.00875267901030373, -0.017143275294465105, -0.019464706406866553, -0.0324138671009076, 0.07860514635157385, -0.14109596817707576, -0.00425161006613583, -0.14978026817413273, -0.03042722727156392, 0.01844418833659248, -0.03659696309045114, -0.08939745824952111, -0.12266909764072759, -0.1250560355230883, -0.08426212362554744, -0.1134794858513295, -0.05910804294480634, 0.02576699867172425, -0.02054271780699461, 0.3320744287551894, 0.3127870849623764], [-0.17288895539991406, -0.0756078147157021, 0.049396044023202385, -0.2336331855175755, 0.07067810266157508, 0.08170835762951008, 0.06076422306365617, 0.13316809616343675, -0.01400107701185431, 0.05275563192995514, 0.031049386146804966, -0.025351670290182142, -0.029933862363672525, 0.11676754626075742, 0.06414258271616012, 0.039904997131366575, -0.03719037923015189, -0.06756570967387232, 0.05732909421897486, 0.02949301559664947, -0.02895609692913142, -0.07573251054778088, -0.07494554243742606, -0.05032558108570399, 0.026358184145553507, -0.03467871066082566, 0.02061355059402574, -0.03858996521952543, -0.056955765675628524, -0.07138882150690483, -0.036934790186343935, -0.03606759245068456, -0.074295087976826, 0.03283550204483976, -0.03683364067682982, -0.013391083712326085, 0.011617107593594389, -0.2174452780977087, 0.03192953152593199, 0.0007725136950456338, -0.0066609031325660295, 0.08572885781438543, 0.007859723467264127, -0.031090400259929825, -0.0012035664390872224, 0.01709524698635168, 0.13710780051128046, 0.06571625918470327, 0.019260190038357886, 0.046485917090559374, 0.014819113416082925, -0.09263158817067929, 0.09525995358912832, -0.10658622247805265, -0.05622522441827199, -0.08649878936026194, 0.11242049973028695, -0.034413170345594456, -0.06180537672875694, 0.009894052898008597, 0.06518325892847163, 0.1599519022309648, 0.10588735109310851, -0.03662409389826212, -0.0854301778219907, -0.041271426125800904, 0.08823460986365293, -0.15701463683137087, -0.07944935388015614, -0.22414271025206442, -0.008819547257363674, 0.09769084189707455, 0.09685380346255676, 0.06144921258465265, 0.05410545716601243, 0.10481665219720551, 0.06124774036686552, 0.08352299619872237, 0.004210414821041102, 0.05116340146676279, 0.04809561884010102, 0.01698274702901268, -0.03258881656896566, -0.12585495731341317, 0.15587666421076607, -0.061736358102379374, 0.248693109919927, -0.02263524434889114, -0.2686114860347778, -0.2450184069334655, -0.21803343561338492, 0.06824304478948476, 0.2650407594332913, -0.08155938776391551, -0.14875191966478066, -0.04775711720504308, -0.004541582065360795, -0.00044579678299426294, 0.1663201750320026, 0.21787280547976334], [-0.08754798619481767, -0.12832845244408345, 0.13323612703474833, -0.21448517192647615, 0.15265009215178987, -0.12129320411260618, -0.16631881863944734, 0.09301172122917914, 0.2210791218270511, -0.07767094597606858, 0.011532335592580092, 0.05586513396234395, 0.2192133767782956, -0.08559390671662943, 0.014414094589677594, -0.08928183678446433, -0.14095005810540612, -0.14801547683713567, -0.04719896611352715, -0.11604322409872238, 0.060814991995059735, 0.046420776379022914, 0.15728257647082539, 0.07493937137544457, -0.11097025840787006, 0.191526493512392, -0.16745280593721545, 0.20940498038798916, -0.048901981652054435, 0.010079784029261355, 0.20237083518323842, 0.01799518157892194, 0.10196230562217608, -0.1618123749483487, 0.1894301468365986, -0.11033488039794051, -0.10875823406243793, -0.0663085651149928, -0.14572967902962491, 0.07055751537037827, -0.08108382694405651, -0.055844294541792704, -0.039062039772478886, -0.011731108784229767, -0.0450396996279873, -0.04673631360928826, -0.07590418169681583, 0.002592348211242983, 0.0031369060145144357, 0.014567955056615841, 0.016274320283579956, -0.058602526633528065, 0.029063948902160273, -0.04106660642290311, -0.01910543498035067, -0.027806456312734415, -0.031530615069528777, 0.027571647749343908, -0.005631303792164935, 0.03921003483827847, -0.060704423742544804, -0.07611266514271857, -0.09215584828551776, 0.05374475122012834, 0.08546068080980221, 0.0643672937382262, -0.07958415395662226, 0.025847737684194846, 0.08709978821859424, 0.017306617576897474, 0.04309971851412797, 0.005086329204172679, 0.04014090266604135, 0.11443775041532882, 0.1555833387818137, 0.049864511502373365, 0.09161686217807591, 0.03754513990863689, 0.08404447358643156, 0.015317154016354948, -0.0020449135400089145, 0.0005530452417903735, -0.023890490601852877, 0.07625884478104906, -0.01099826846083527, -0.07771317485990883, -0.03330205765715765, -0.06343648543240135, 0.09424603980247878, 0.06410183085805424, -0.03693814491816669, -0.07347764246007533, -0.14942680153998456, -0.11369026551307822, -0.104715101461197, -0.11665765958217217, -0.06697386380140852, 0.08841125237088782, 0.18212810571893265, 0.21926960834844658], [0.051512408798651675, 0.03849516913938012, -0.10940304299778858, 0.06322203748030465, -0.10417396115656843, 0.03474730041039886, -0.16882150173946384, -0.07642937022031461, 0.06916120446645031, -0.05612366202117828, 0.09661014610006398, -0.010397808557138847, 0.1158670481153929, -0.07221658001275799, 0.19257256851771773, -0.08669553400906473, -0.09922027687090959, -0.0883446868276571, 0.22478489071856855, -0.018489334404928903, 0.021395705989752756, 0.14429453407849274, 0.19522497771609704, 0.12250219547649194, -0.04753354770556419, 0.08651016897029144, -0.08914591875630748, 0.043911170183270745, -0.04686633390714434, 0.08274784179043665, 0.040467282564797445, -0.005280480443943599, 0.1655413456167464, -0.14552784360376808, 0.0756386642991008, -0.08171254048881656, -0.08223351201634574, -0.0032001449159120244, -0.06331317093438146, -0.02642462744228548, -0.048152098203007865, -0.00846896221406995, -0.0907927591241589, -0.13170229263396346, -0.0838003543348731, -0.05601389346572892, 0.06213542022011505, -0.13667859945939365, -0.12232590135257776, -0.13741975848989693, 0.01805536141395218, -0.06717233836765377, 0.018487632734106346, -0.07334825445610847, -0.05463168899374344, -0.06264894716010859, 0.039591140313472405, 0.00110890050456352, -0.04883412149731063, 0.012764493894801941, 0.04471382382036998, 0.021273059136432196, 0.2817542064876368, 0.08301399970083555, -0.06714477409202893, 0.10652087601493548, 0.28273348311443675, -0.011194564228291893, -0.0179186343529452, -0.014776284647065327, 0.023691874342185757, 0.053295697590956065, -0.008147313875618428, 0.04374257804609407, 0.03888383059362039, 0.023185469430060893, 0.021320919018949766, -0.035553825311698165, -0.0257254602055571, -0.04208078730936514, -0.033567856689518887, -0.03260048629469819, -0.01663140844438769, -0.055708429138893685, 0.038497193855231725, 0.021810955852252848, 0.10629152938838961, 0.013782204729992423, -0.11853335696692067, -0.14495869231829206, -0.032394895548047774, -0.03567413075496643, 0.10139717582711151, 0.22340155161948036, 0.06937140469363921, 0.1730405476655135, 0.10932660882299829, -0.12952887583278286, -0.2384563639648442, -0.23948946168932592]])
    explained_variance = np.array([109449.66861784918, 32388.609445327267, 24169.93681605564, 19762.47597835777, 15354.174924137156, 13804.822859664231, 9910.576736581419, 8432.20104427652, 8069.266010697484, 6801.484550989703, 6476.203094181213, 5639.610046725533, 5358.230858730513, 4553.46422136783, 4188.35562097799, 4110.559796410708, 3750.0683865862247])
    X = X - mean
    X_transformed = np.dot(X, components.T)
    return X_transformed

w_h = np.array([[-0.057966072112321854, 0.16834545135498047, -0.39948558807373047, -0.08928626030683517, -0.15668201446533203, 0.02113504894077778, 0.11256695538759232, 0.27481403946876526, -0.09889619797468185, 0.013182180933654308, -0.2131509929895401, 0.016960710287094116, -0.1520974487066269, -0.18365991115570068, 0.010392213240265846, -0.14121010899543762, 0.09310868382453918], [-0.01255713403224945, -0.4004282057285309, -0.44939473271369934, 0.23090077936649323, 0.4542904794216156, 0.022710688412189484, 0.26713472604751587, -0.05889376997947693, 0.11988354474306107, -0.009301894344389439, -0.5479718446731567, -0.3573046922683716, 0.0890912339091301, -0.008467812091112137, 0.09563587605953217, -0.2868482768535614, 0.0508386604487896], [-0.00997666921466589, -0.20411643385887146, -0.24646151065826416, 0.12189080566167831, 0.24482639133930206, 0.010306495241820812, 0.14189977943897247, -0.0286567360162735, 0.05639654025435448, -0.004767111036926508, -0.2999299168586731, -0.18356133997440338, 0.046808190643787384, -0.0116271385923028, 0.05663364753127098, -0.15536780655384064, 0.029461737722158432], [0.2967458963394165, 0.311654657125473, -0.3032064735889435, 0.005876481533050537, -0.022274263203144073, 0.19786401093006134, 0.023451710119843483, 0.040851276367902756, -0.1418459415435791, -0.0843530222773552, 0.08587919920682907, -0.2849040925502777, -0.09434209764003754, 0.12735657393932343, 0.10637687891721725, -0.14121845364570618, 0.15855833888053894], [0.293506920337677, 0.3482622802257538, -0.35712721943855286, -0.03297066316008568, -0.014232205227017403, 0.23080182075500488, 0.07766364514827728, 0.16240619122982025, -0.13764376938343048, -0.15749064087867737, 0.13180705904960632, -0.34049201011657715, -0.16029754281044006, 0.1441303789615631, 0.07007701694965363, -0.2284272313117981, 0.1718003749847412], [0.03546729311347008, 0.025610992684960365, -0.14345139265060425, 0.06034659594297409, -0.2737552523612976, 0.12293556332588196, 0.14567150175571442, 0.35491281747817993, 0.1458122283220291, -0.31628116965293884, -0.247757226228714, 0.21959903836250305, 0.04343928024172783, -0.3410768508911133, -0.32408925890922546, 0.46738186478614807, 0.25664442777633667], [-0.04437735304236412, 0.18912860751152039, -0.47069796919822693, -0.13169613480567932, -0.3234657049179077, 0.0021046623587608337, 0.025537047535181046, 0.34807395935058594, -0.1393565535545349, 0.1940932720899582, -0.22375720739364624, 0.10150596499443054, -0.14584188163280487, -0.3142673671245575, -0.04864509403705597, -0.11033100634813309, 0.09987161308526993], [0.2895215153694153, 0.1569569706916809, -0.18107934296131134, 0.16495771706104279, -0.009549923241138458, -0.017859352752566338, -0.13867062330245972, -0.2863847613334656, -0.16604499518871307, 0.10625920444726944, -0.205898255109787, -0.09269288927316666, 0.0977325588464737, 0.10728084295988083, 0.2612493932247162, 0.18534068763256073, -0.009639430791139603], [0.16880524158477783, -0.0859706848859787, 0.018984349444508553, 0.3864082396030426, 0.3421260714530945, 0.1538662612438202, 0.3423338234424591, 0.12135738134384155, -0.5136494636535645, 0.13852424919605255, 0.12350504845380783, -0.22520841658115387, -0.03532060980796814, -0.26347529888153076, -0.27444708347320557, -0.36445507407188416, -0.17432008683681488]])
b_h = np.array([0.5421903729438782, 0.011994916945695877, -0.11620258539915085, 0.49518707394599915, -0.07536504417657852, 0.07556258887052536, -0.43516573309898376, -0.4256799817085266, -0.29283028841018677])
w_o = np.array([[0.09319409728050232, 0.2440752238035202, -0.44948676228523254, 0.23331424593925476, -0.19185103476047516, -0.0033768184948712587, -0.0551246777176857, -0.04358839988708496, -0.008316623978316784]])
b_o = np.array(-0.22582976520061493)

print (w_h.shape)
print(b_h.shape)
print(w_o.shape)
print(b_o.shape)

imp = [72, 392, 803, 912, 971, 1028, 1038, 1142, 1303, 1369, 1428, 1464, 1472, 1567, 1613, 1621, 1626, 1628, 1691, 1815, 1872, 1885, 1892, 1895, 1899, 1951, 1984, 2037, 2042, 2064, 2121, 2124, 2145, 2154, 2201, 2210, 2235, 2261, 2296, 2373, 2376, 2710, 2871, 2952, 2955, 3040, 3050, 3073, 3153, 3157, 3278, 3286, 3310, 3369, 3437, 3453, 3514, 3533, 3536, 3569, 3591, 3595, 3632, 3670, 3695, 3755, 3800, 3914, 3945, 4083, 4091, 4272, 4513, 4530, 4698, 4712, 4715, 4849, 4886, 4935, 5020, 5103, 5184, 5310, 5466, 5521, 5548, 5691, 5733, 6070, 6082, 6398, 6555, 6603, 6760, 6770, 6775, 6918, 7033, 7039]

features_to_use = [5521, 3914, 5691, 1303, 392, 2710, 2955, 1892, 3670, 1613, 3453, 7039, 803, 3800, 5103, 6770, 2210, 5184, 4530, 5466, 3278, 5020, 3286, 1472, 3153, 3536, 3569, 1628, 2145, 3050, 3157, 3437, 3595, 3945, 6918, 4849, 912, 1567, 2296, 5548, 1142, 72, 1028, 2037, 1899, 2373, 3755, 6070, 6603, 1038, 1951, 2124, 2952, 3073, 4513, 4715, 4886, 7033, 4698, 4712, 6775, 1815, 2042, 2064, 2235, 3040, 3310, 3369, 3514, 3533, 4091, 4272, 1464, 3695, 1369, 1428, 1621, 1691, 1895, 1984, 2121, 2201, 2871, 3591, 3632, 4083, 5310, 6082, 6398, 6555, 6760, 1885, 4935, 5733, 971, 1626, 1872, 2154, 2261, 2376]


# TODO:
# load in data
# select the useful features
# transform data
# make mlp
# train loop
# evaluate on diff 


with open("training_log.txt", "w") as f:
    f.write("Train data percent \t Training Loss \t Training Accuracy \t Validation Loss \t Validation Accuracy \n")

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")

# # Load dataset
data = pd.read_csv('dataset.csv', header=None)
train_data = data[imp].values
labels = data[data.columns[-1]].values
print(np.unique(labels))
print(data.shape)

transformed_data = __transform(train_data)
print(transformed_data.shape)
print(labels.shape)
print(type(transformed_data), type(labels))

train_set = TensorDataset(torch.tensor(transformed_data), torch.tensor(labels))

class FCN(nn.Module):
    def __init__(self):
        super().__init__()
        self.layer_stack = nn.Sequential(
            nn.Linear(17, 9),
            nn.ReLU(),
            nn.Linear(9, 1)
        )

    def forward(self, x):
        return self.layer_stack(x)
    


for train_data_percent in [.05, .1, .2, .4, .8, 1.0]:

    # 80/20 train/val split
    train_size = int(.8 * len(train_set))
    val_size = int(.2 * len(train_set))
    # unused_size = len(train_set) - train_size - val_size
    cur_train_set, cur_val_set = random_split(train_set, [train_size, val_size])

    used_train_size = int(train_data_percent * len(cur_train_set))
    unused_train_size = len(cur_train_set) - used_train_size
    cur_train_set, _ = random_split(cur_train_set, [used_train_size, unused_train_size])
    # Batch size
    batch_size = 16

    print(len(cur_train_set))
    # print(val_set.shape)

    # Create dataloaders
    train_loader = DataLoader(cur_train_set, batch_size=batch_size, shuffle=True)
    val_loader = DataLoader(cur_val_set, batch_size=batch_size, shuffle=True)

    model = FCN().to(device)

    # Set optimizer
    optimizer = torch.optim.Adam(model.parameters(), lr=5e-4)

    # Run training
    log = {"epoch": [], 
        "train_loss": [], 
        "train_acc": [],
        "val_loss": [],
        "val_acc": []}
    
    for epoch in range(200):
        train_loss = []
        model.train()
        train_correct = 0
        for data in tqdm(train_loader):
            x = data[0].float().to(device)
            y = data[1].float().to(device)
            pred = model(x).squeeze()
            pred = nn.Sigmoid()(pred)
            # Compute loss
            loss = nn.BCELoss(reduction="mean")(pred, y)
            train_loss.append(loss.item())
            optimizer.zero_grad()
            loss.backward() # backprop
            optimizer.step() # optimize
            # Accuracy
            train_correct += (((pred > 0.5) * y) + ((pred <= 0.5) * (1 - y))).sum().item()
        
        model.eval()
        val_loss = []
        val_correct = 0
        for data in tqdm(val_loader):
            x = data[0].float().to(device)
            y = data[1].float().to(device)
            pred = model(x).squeeze()
            pred = nn.Sigmoid()(pred)
            # Compute loss
            loss = nn.BCELoss(reduction="mean")(pred, y)
            val_loss.append(loss.item())
            # Accuracy
            val_correct += (((pred > 0.5) * y) + ((pred <= 0.5) * (1 - y))).sum().item()
        
    final_train_loss = sum(train_loss) / len(train_loss)
    final_train_acc = train_correct / train_size
    final_val_loss = sum(val_loss) / len(val_loss)
    final_val_acc = val_correct / val_size

    with open("training_log.txt", "a") as f:
        line = (str(train_data_percent) + "\t" +
                str(final_train_loss) + "\t" +
                str(final_train_acc) + "\t" +
                str(final_val_loss) + "\t" +
                str(final_val_acc) + "\n")
        print(line)
        f.write(line)
    log["epoch"].append(train_data_percent)
    log["train_loss"].append(final_train_loss)
    log["train_acc"].append(final_train_acc)
    log["val_loss"].append(final_val_loss)
    log["val_acc"].append(final_val_acc)